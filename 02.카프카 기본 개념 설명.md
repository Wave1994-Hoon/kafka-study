## 02.카프카 기본 개념 설명
### 1. 카프카 생태계
<img width="800" src="https://user-images.githubusercontent.com/60383031/187068835-eaf662ba-92e2-49fa-b394-8e0b8dd9ff18.png">

<br>

### 2. 주기퍼
<img width="800" src="https://user-images.githubusercontent.com/60383031/187068747-6182fa31-ab30-4b8e-a0b8-05f1a68efd4b.png">

카프카 클러스터를 실행하기 위해서는 주키퍼가 필요

주키퍼의 서로 다른 znode 에 클러스터를 지정하면 됨

카프카 3.0 부터는 주키퍼 없이도 카프카 클러스터 운영이 가능하지만 아직 레퍼런스가 많이 부족 

<br>

### 3. 브로커의 역할 - 컨트롤러, 데이터 삭제
#### 3.1 컨트롤러
클러스터 다수 브로커 한 대가 컨트롤러 역할을 한다.

컨트롤러는 다른 브로커 상태를 체크하고, 리더 파티션 재분배하는 역할을 한다.

#### 3.2 데이터 삭제
로그 세그먼트 파일을 삭제한다.

#### 3.3 컨슈머 오프셋 저장
커밋한 오프셋은 _consumer_offsets 토픽에 저장한다.

여기에 저장된 오프셋을 보고 컨슈머 그룹은 다음 레코드를 가져와서 처리한다.

#### 3.4 그룹 코디네이터
컨슈머 그룹의 상태를 체크하고 파티션을 컨슈머와 매칭되도록 분배하는 역할을 한다. (리밸런싱)

<br>

### 4. 브로커의 역할 - 데이터 저장
#### 4.1 로그와 세그먼트
<img width="800" src="https://user-images.githubusercontent.com/60383031/187133584-381f6934-288b-4778-a1b3-2ed4c66b2f06.png">


#### 4.2 액티브 세그먼트
가장 마지막으로 쓰기가 일어나고 있는 세그먼트 파일

액티브 세그먼트는 삭제 대상이 되지 않는다.

<br>

### 5. 브로커의 역할 - 복제 (replication)
<img width="800" src="https://user-images.githubusercontent.com/60383031/187134382-36974c7a-adbd-4c9a-bcc6-b455e03f90d6.png">

카프카의 데이터 복제는 파티션 단위로 이루어진다.

복제 갯수의 최소값은 1(복제 없음), 최대값은 브로커 개수만큼 선택할 수 있다.

복제된 파티션은 리더와 팔로워로 구성된다. (토픽 단위가 아닌 파티션 단위로 리더/팔로워가 선출된다.)

<img width="800" src="https://user-images.githubusercontent.com/60383031/187135002-46312168-539a-4fce-a74f-f0f6c531a01c.png">

파티션이 복제되면 복제된 만큼 저장 용량이 증가한다.

<br>

### 6. ISR (In-Sync-Replicas)
<img width="800" src="https://user-images.githubusercontent.com/60383031/187135462-00565736-43b6-4c4e-9e33-15671a1d6d82.png">

ISR 은 리더와 팔로워(파티션)이 모두 싱크가 된 상태를 뜻한다.

<img width="800" src="https://user-images.githubusercontent.com/60383031/187135728-1cb0f146-c865-45dd-98c7-c9316a8abdb7.png ">








